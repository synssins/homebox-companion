name: Deploy to homelab

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: self-hosted   # assumes this is your only self-hosted runner

    steps:
      - name: Deploy latest code and restart service
        run: |
          set -e

          cd /home/homebox/homebox-app

          # pull latest main
          git fetch origin
          git reset --hard origin/main

          # update venv
          uv sync

          # restart the app
          sudo systemctl restart homebox-vision.service

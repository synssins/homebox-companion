================================================================================
HOMEBOX-COMPANION FORK - FEATURES & ROADMAP
================================================================================

Base Version: upstream/main @ 2.2.0
Enhancement Branch: dev-v2.2.0
Last Updated: 2026-01-06

================================================================================
FEATURES COMPLETED (Ready for PR after config consolidation)
================================================================================

1. MULTI-PROVIDER AI CONFIGURATION
   - Configure OpenAI, Anthropic, Ollama from Settings UI
   - Enable/disable individual providers with toggles
   - Visual badge showing active provider
   - Test Connection button for validation

2. LOCAL AI (OLLAMA) INTEGRATION
   - Privacy-first local processing
   - GPU detection and status display
   - Model selection from available models

3. DUPLICATE DETECTION BY SERIAL NUMBER
   - Persistent index of existing serial numbers
   - Warns during review when matches found
   - Non-blocking (user can still add items)
   - Differential updates (only fetches new items)
   - Manual rebuild from Settings

4. IN-APP SETTINGS (NO YAML REQUIRED)
   - Connection Settings: Homebox URL, Image Quality
   - AI Provider Settings: All provider configuration
   - Behavior Settings: Duplicate detection toggle
   - Settings persist across container restarts

5. GROUPED DETECTION API (Backend Only)
   - POST /api/vision/detect-grouped endpoint
   - AI analyzes images and groups by physical item
   - Returns items with image_indices for grouping

6. BUG FIXES
   - UI freeze prevention (Svelte 5 $effect loops)
   - API paginated response handling
   - Asset ID string parsing
   - Skip on last item navigation

================================================================================
PR NOTE
================================================================================

The current feature set in GitHub main branch is intended for PR submission
to the original maintainer (Duelion/homebox-companion) AFTER completing:

  [ ] Config path consolidation (see Technical Debt below)
  [ ] Security code review (see Security section below)

This represents a cohesive set of enhancements:
- Multi-provider AI with local AI support
- Duplicate detection for inventory management
- Simplified deployment via in-app configuration

================================================================================
REMAINING TODOS
================================================================================

HIGH PRIORITY (User-ordered)
----------------------------

1. [x] CONFIG PATH CONSOLIDATION (COMPLETED 2026-01-06)
       - Consolidated from two volume mounts to single /app/data
       - Updated ai_config.py, app_preferences.py, field_preferences.py
       - All config files now stored alongside session data
       - Updated README.md and Wiki documentation

2. [ ] GROUPED DETECTION FRONTEND
       - Backend endpoint exists (/detect-grouped)
       - Add UI for grouped detection workflow
       - Drag-to-group interface (now possible with desktop UI)
       - Visual grouping indicators
       - Ungroup capability

3. [ ] ENRICHMENT SERVICE
       - Web lookup for product specifications
       - MUST be enable/disable toggleable in Settings
       - Privacy notice when enabled
       - Serial numbers NEVER sent externally
       - Data sources:
         1. Manufacturer websites (primary for MSRP)
         2. Price matching fallback for items without manufacturer MSRP:
            - Best Buy
            - Home Depot
            - Amazon
            - Lowes
            - Other well-known vendors
       - PRICING RULES:
         * Prefer HIGHER prices (for insurance valuation purposes)
         * Use regular/list prices, NOT sale prices
         * MSRP > Retail price > Street price
         * Document price source and date retrieved
       - Extract: MSRP, features, specifications, release year
       - Populate description with rich feature list

4. [ ] THEME SUPPORT
       - Align with Homebox theme system
       - Support light/dark modes matching Homebox
       - Detect and sync with Homebox theme preference if possible
       - User-selectable theme in Settings

5. [ ] FULL CRASH RECOVERY INTEGRATION
       - Backend infrastructure exists (StateManager, session APIs)
       - Connect session state to actual workflow
       - Show RecoveryBanner when interrupted session detected
       - One-click resume from where user left off

COMPLETED
---------

[x] RESPONSIVE WEB UI
    - Extended AppContainer max-widths for desktop (up to 6xl)
    - Desktop header navigation replacing bottom nav on lg+ screens
    - Capture page: Responsive grid for image cards (2-3 columns)
    - Review page: Side-by-side layout with image and form
    - Settings page: Two-column grid for settings sections
    - Summary page: Responsive grid for confirmed items
    - Breakpoints used:
      - Mobile: < 768px (md breakpoint)
      - Tablet: 768px - 1024px
      - Desktop: > 1024px (lg breakpoint)

MEDIUM PRIORITY
---------------

[ ] CLIPBOARD PASTE SUPPORT
    - Ctrl+V / Cmd+V to paste images
    - Useful for screenshots of labels/receipts
    - Requires desktop/tablet UI for practical use

[ ] PHOTO GROUPING UI (Manual)
    - Manual grouping during review phase
    - Merge multiple detected items into one
    - Drag-drop interface (requires larger screen)

[ ] GPU SETTINGS DISPLAY
    - Show detected GPU in Settings
    - GPU type, VRAM, utilization
    - Toggle GPU acceleration on/off

LOW PRIORITY
------------

[ ] EMBEDDED OLLAMA DOCKER IMAGE
    - Single container with Ollama built-in
    - Model pre-loading at build time
    - Larger image but simpler deployment

[ ] AIR-GAPPED DEPLOYMENT MODE
    - No external network calls whatsoever
    - Pre-bundled AI models
    - For high-security environments

================================================================================
SECURITY
================================================================================

[ ] SECURITY CODE REVIEW (Required before PR)
    - Review for OWASP Top 10 vulnerabilities
    - Check for common security issues:
      * SQL Injection (if any DB queries)
      * XSS (Cross-Site Scripting) in frontend
      * CSRF (Cross-Site Request Forgery)
      * Command Injection in any shell/subprocess calls
      * Path Traversal in file operations
      * Insecure Deserialization
      * Sensitive Data Exposure (API keys, tokens in logs)
      * Authentication/Authorization bypass
      * SSRF (Server-Side Request Forgery) in enrichment/web fetches

[ ] API SECURITY AUDIT
    - Verify all endpoints require authentication where appropriate
    - Check token handling and expiration
    - Review CORS configuration
    - Validate input sanitization on all endpoints
    - Check rate limiting effectiveness

[ ] SECRETS MANAGEMENT
    - Ensure API keys never logged (even in debug mode)
    - Verify SecretStr usage for sensitive fields
    - Check .env files excluded from git
    - Review Docker environment variable handling

[ ] DEPENDENCY SECURITY
    - Run dependency vulnerability scan (pip-audit, npm audit)
    - Update any packages with known CVEs
    - Pin dependencies to specific versions
    - Document known security advisories

[ ] FILE OPERATION SECURITY
    - Validate file paths prevent directory traversal
    - Check file upload handling (size limits, type validation)
    - Ensure temp files cleaned up properly
    - Review permissions on created files/directories

[ ] FRONTEND SECURITY
    - CSP (Content Security Policy) headers
    - XSS prevention in user-generated content display
    - Secure cookie settings (HttpOnly, Secure, SameSite)
    - No sensitive data in localStorage/sessionStorage

================================================================================
TECHNICAL DEBT
================================================================================

[x] Config Path Consolidation (COMPLETED)
    - All config files now use settings.data_dir
    - Single /app/data volume mount required
    - Documentation updated (README + Wiki)

[ ] Gitea Branch Protection
    - Main branch push currently blocked
    - Needs manual configuration in Gitea admin

================================================================================
IMPLEMENTATION NOTES
================================================================================

RESPONSIVE UI APPROACH:
- Use Tailwind CSS responsive prefixes (sm:, md:, lg:)
- Consider component variants for different screen sizes
- Test on actual devices, not just browser resize
- Mobile-first design, enhance for larger screens

THEME SUPPORT APPROACH:
- Check if Homebox exposes theme via API or cookie
- CSS custom properties for theme values
- Persistent theme preference in app_preferences.json
- System preference detection as fallback

ENRICHMENT SERVICE ARCHITECTURE:
- New service: src/homebox_companion/services/enrichment.py
- New routes: src/homebox_companion/routes/enrichment.py
- Settings toggle in Behavior Settings section
- Price matching priority:
  1. Manufacturer MSRP (most accurate)
  2. Best Buy (reliable pricing)
  3. Home Depot (tools, home goods)
  4. Amazon (wide coverage, variable pricing)
- Cache results to avoid repeated lookups
- Rate limiting for external requests

================================================================================
END OF DOCUMENT
================================================================================

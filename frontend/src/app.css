@tailwind base;
@tailwind components;
@tailwind utilities;

/* Base styles */
@layer base {
	html {
		font-family: 'Inter', 'Outfit', system-ui, sans-serif;
	}

	body {
		min-height: 100vh;
		min-height: 100dvh;
		/* Disable native pull-to-refresh on mobile Chrome */
		overscroll-behavior-y: none;
	}

	/* Custom scrollbar */
	::-webkit-scrollbar {
		width: 6px;
		height: 6px;
	}

	::-webkit-scrollbar-track {
		background: transparent;
	}

	::-webkit-scrollbar-thumb {
		background: rgba(255, 255, 255, 0.2);
		border-radius: 3px;
	}

	::-webkit-scrollbar-thumb:hover {
		background: rgba(255, 255, 255, 0.3);
	}
}

/* Component utilities */
@layer components {
	/* Icon button - compact */
	.btn-icon {
		@apply rounded-lg p-2 transition-colors duration-150 hover:bg-base-300 hover:text-base-content focus:outline-none focus:ring-2 active:bg-base-300;
		color: oklch(var(--bc) / 0.6);
		--tw-ring-color: oklch(var(--p) / 0.5);
	}
	.btn-icon:active {
		background-color: oklch(var(--b3) / 0.8);
	}

	/* Input styles */
	.input {
		@apply w-full rounded-xl bg-base-200 px-4 py-3 text-base-content transition-all duration-150 focus:bg-base-300 focus:outline-none focus:ring-2 disabled:cursor-not-allowed disabled:bg-base-100;
		border: 1px solid oklch(var(--bc) / 0.2);
		--tw-ring-color: oklch(var(--p) / 0.2);
	}
	.input:focus {
		border-color: oklch(var(--p));
	}
	.input::placeholder {
		color: oklch(var(--bc) / 0.4);
	}
	.input:disabled {
		border-color: oklch(var(--bc) / 0.1);
		color: oklch(var(--bc) / 0.3);
	}

	/* Compact input variant for modals and dense UIs */
	.input-sm {
		@apply w-full rounded-lg bg-base-200 px-3 py-2 text-sm text-base-content transition-all duration-150 focus:bg-base-300 focus:outline-none focus:ring-2 disabled:cursor-not-allowed disabled:bg-base-100;
		border: 1px solid oklch(var(--bc) / 0.2);
		--tw-ring-color: oklch(var(--p) / 0.2);
	}
	.input-sm:focus {
		border-color: oklch(var(--p));
	}
	.input-sm::placeholder {
		color: oklch(var(--bc) / 0.4);
	}
	.input-sm:disabled {
		border-color: oklch(var(--bc) / 0.1);
		color: oklch(var(--bc) / 0.3);
	}

	/* Input error state */
	.input-error {
		@apply focus:ring-2;
		border-color: oklch(var(--er));
		--tw-ring-color: oklch(var(--er) / 0.2);
	}
	.input-error:focus {
		border-color: oklch(var(--er));
	}

	/* Expandable input - base styles for use with expandable action */
	.input-expandable {
		@apply input;
		resize: none;
	}

	/* Label styles */
	.label {
		@apply mb-2 block text-body-sm font-medium;
		color: oklch(var(--bc) / 0.75);
	}

	/* Compact label for modals and dense UIs */
	.label-sm {
		@apply mb-1 block text-xs font-medium;
		color: oklch(var(--bc) / 0.6);
	}

	/* Label chip / badge styles */
	.label-chip {
		@apply cursor-pointer rounded-lg bg-base-200 px-3 py-1.5 text-sm transition-all duration-150 hover:bg-base-300;
		border: 1px solid oklch(var(--bc) / 0.2);
		color: oklch(var(--bc) / 0.75);
	}
	.label-chip:hover {
		border-color: oklch(var(--bc) / 0.3);
	}

	.label-chip-selected {
		@apply rounded-lg border-2 px-3 py-1.5 text-sm font-medium shadow-sm ring-2;
		border-color: oklch(var(--p));
		color: oklch(var(--p));
		background-color: oklch(var(--p) / 0.2);
		--tw-ring-color: oklch(var(--p) / 0.2);
	}

	/* Touch-target icon button */
	.btn-icon-touch {
		@apply flex min-h-touch min-w-touch items-center justify-center rounded-lg p-2 transition-all hover:bg-base-300 hover:text-base-content;
		color: oklch(var(--bc) / 0.6);
	}

	/* Card base styles - use for lightweight card-like containers without importing Card.svelte */
	.card {
		@apply rounded-xl bg-base-200 p-4 shadow-sm;
		border: 1px solid oklch(var(--bc) / 0.2);
	}

	.card-interactive {
		@apply card cursor-pointer transition-all hover:bg-base-300 hover:shadow-md active:scale-[0.99];
	}
	.card-interactive:hover {
		border-color: oklch(var(--bc) / 0.3);
	}

	/* ==========================================================================
	   Chat Styling - Edit these to adjust chat density/sizing
	   ========================================================================== */

	/* Chat bubble container */
	.chat-bubble {
		@apply break-words rounded-2xl px-3 py-2 text-body;
	}

	/* User message line height */
	.chat-bubble-user {
		@apply leading-snug;
	}

	/* Metadata row (timestamp, tokens) */
	.chat-meta {
		@apply mt-0.5 flex items-center gap-1.5 px-1.5 text-xs;
		color: oklch(var(--bc) / 0.4);
	}

	/* Tool accordion section */
	.chat-tools-section {
		@apply mt-1.5 pt-1.5;
		border-top: 1px solid oklch(1 0 0 / 0.1);
	}

	.chat-tools-summary {
		@apply flex cursor-pointer select-none items-center gap-1 text-xs;
		color: oklch(var(--bc) / 0.6);
	}
	.chat-tools-summary:hover {
		color: oklch(var(--bc) / 0.75);
	}

	.chat-tools-grid {
		@apply mt-1.5 flex flex-wrap gap-1;
	}

	/* Tool/action badge */
	.chat-tool-badge {
		@apply inline-flex items-center gap-0.5 rounded-md border px-1.5 py-0.5 text-xs font-medium;
	}

	/* Approval badge button */
	.chat-approval-badge {
		@apply mt-1.5 flex w-full items-center gap-1.5 rounded-lg border px-2 py-1.5 text-left text-xs font-medium transition-all active:scale-[0.98];
	}

	/* ==========================================================================
	   Markdown Content Styling (extracted from ChatMessage for reuse)
	   ========================================================================== */
	.markdown-content {
		margin: 0;
		line-height: 1.35;
	}

	.markdown-content ul,
	.markdown-content ol {
		margin: 0.25rem 0;
		padding-left: 1.25rem;
	}

	.markdown-content ul {
		list-style-type: disc;
	}

	.markdown-content ol {
		list-style-type: decimal;
	}

	.markdown-content li {
		margin: 0.125rem 0;
	}

	.markdown-content p {
		margin: 0.25rem 0;
	}

	.markdown-content p:first-child {
		margin-top: 0;
	}

	.markdown-content p:last-child {
		margin-bottom: 0;
	}

	.markdown-content *:last-child {
		margin-bottom: 0;
	}

	.markdown-content strong {
		font-weight: 600;
		@apply text-base-content;
	}

	.markdown-content em {
		font-style: italic;
	}

	.markdown-content code {
		@apply rounded px-1 py-0.5 font-mono text-[0.85em];
		background-color: oklch(var(--p) / 0.1);
	}

	.markdown-content pre {
		@apply my-1.5 overflow-x-auto rounded-lg p-2;
		background-color: oklch(0 0 0 / 0.3);
	}

	.markdown-content pre code {
		@apply bg-transparent p-0;
	}

	.markdown-content h1,
	.markdown-content h2,
	.markdown-content h3 {
		@apply font-semibold text-base-content;
		margin: 0.5rem 0 0.25rem;
	}

	.markdown-content h1 {
		@apply text-h4;
	}

	.markdown-content h2 {
		@apply text-body;
	}

	.markdown-content h3 {
		@apply text-body-sm;
	}

	/* GFM Tables */
	.markdown-content table {
		@apply my-3 w-full border-collapse;
	}

	.markdown-content th,
	.markdown-content td {
		@apply px-3 py-2 text-left;
		border: 1px solid oklch(var(--bc) / 0.3);
	}

	.markdown-content th {
		@apply font-semibold text-base-content;
		background-color: oklch(var(--b3) / 0.5);
	}

	.markdown-content tr:nth-child(even) {
		background-color: oklch(var(--b3) / 0.3);
	}

	/* GFM Task Lists */
	.markdown-content input[type='checkbox'] {
		@apply mr-2;
		accent-color: oklch(var(--p));
	}

	.markdown-content li:has(input[type='checkbox']) {
		list-style: none;
		margin-left: -1.25rem;
	}

	/* Links */
	.markdown-content a {
		@apply underline transition-colors;
		color: oklch(var(--p));
	}
	.markdown-content a:hover {
		color: oklch(var(--p) / 0.8);
	}

	/* Blockquotes */
	.markdown-content blockquote {
		@apply my-3 pl-4 italic;
		border-left: 4px solid oklch(var(--p) / 0.5);
		color: oklch(var(--bc) / 0.6);
	}

	/* Horizontal Rule */
	.markdown-content hr {
		@apply my-4;
		border-color: oklch(var(--bc) / 0.3);
	}

	/* Strikethrough */
	.markdown-content del {
		color: oklch(var(--bc) / 0.4);
	}
}

/* Animation utilities */
@layer utilities {
	.animate-in {
		animation:
			fadeIn 0.25s ease-out,
			slideUp 0.25s ease-out;
	}

	/* Avoid double-animations: disable per-page animate-in when View Transitions are enabled */
	.vt-enabled .animate-in {
		animation: none !important;
	}

	/*
	 * Note: View Transitions already block interaction during page transitions,
	 * so we don't need additional pointer-events manipulation here.
	 * The previous implementation was blocking button clicks on touch devices.
	 */

	.glass {
		@apply backdrop-blur-lg;
		background-color: oklch(var(--b2) / 0.8);
	}

	/* iOS safe area padding for bottom navigation */
	.pb-safe {
		padding-bottom: env(safe-area-inset-bottom, 0px);
	}

	/* iOS safe area padding for top status bar */
	.pt-safe {
		padding-top: env(safe-area-inset-top, 0px);
	}

	/* Position above bottom navigation with safe area (mobile only) */
	.bottom-nav-offset {
		/* Height of bottom nav (h-16 = 4rem) + iOS safe area */
		bottom: calc(4rem + env(safe-area-inset-bottom, 0px));
		/* Ensure proper stacking and prevent layout shifts on iOS Safari */
		transform: translateZ(0);
		-webkit-transform: translateZ(0);
	}

	/* On desktop (lg+), bottom nav is hidden, so no offset needed */
	@media (min-width: 1024px) {
		.bottom-nav-offset {
			bottom: 0;
		}
	}

	/* Skeleton loading animation */
	.skeleton {
		@apply animate-shimmer rounded bg-base-300;
		background: linear-gradient(
			90deg,
			oklch(var(--b3)) 25%,
			oklch(var(--b2)) 50%,
			oklch(var(--b3)) 75%
		);
		background-size: 200% 100%;
	}

	/* Checkmark draw animation for success pages */
	.checkmark-draw {
		stroke-dasharray: 50;
		stroke-dashoffset: 50;
		@apply animate-draw-check;
	}

	/* Success circle scale in */
	.success-scale {
		transform: scale(0);
		@apply animate-scale-up;
	}

	/* Page container with bottom nav offset */
	.page-content {
		@apply animate-in pb-28;
	}

	/* Fixed bottom panel above nav */
	.fixed-bottom-panel {
		@apply bottom-nav-offset fixed left-0 right-0 z-40 backdrop-blur-lg;
		border-top: 1px solid oklch(var(--bc) / 0.1);
		background-color: oklch(var(--b1) / 0.95);
	}

	/* Chat input container - adapts position for mobile virtual keyboard */
	.chat-input-keyboard-aware {
		@apply bottom-nav-offset fixed left-0 right-0 z-50 backdrop-blur-lg;
		border-top: 1px solid oklch(var(--bc) / 0.1);
		background-color: oklch(var(--b1) / 0.95);
		/* Ensure proper stacking and prevent layout shifts on iOS Safari */
		transform: translateZ(0);
		-webkit-transform: translateZ(0);
		/* Smooth transition when keyboard opens/closes */
		transition: bottom 0.15s ease-out;
	}

	/* Empty state container */
	.empty-state {
		@apply flex min-h-[35vh] flex-col items-center justify-center px-6 py-12 text-center;
	}
}

/* Keyframes now consolidated in tailwind.config.js:
 * - fadeSlideIn -> animate-fade-slide-in
 * - drawCheck -> animate-draw-check
 * - scaleIn -> animate-scale-in (with opacity) / animate-scale-up (scale only)
 */

/* ==========================================================================
   Page transitions (View Transitions API)
   Progressive enhancement: only used by browsers that implement the API.
   ========================================================================== */

@media (prefers-reduced-motion: reduce) {
	::view-transition-old(root),
	::view-transition-new(root) {
		animation: none;
	}
}

@media (prefers-reduced-motion: no-preference) {
	::view-transition-old(root) {
		animation: vt-fade-out 180ms ease-out both;
	}

	::view-transition-new(root) {
		animation: vt-fade-in 180ms ease-out both;
	}

	/* Keep fixed UI elements stable during page transitions - no animation */
	/* We hide the old snapshot entirely because backdrop-blur effects can't be 
	   captured properly in View Transition snapshots, causing a "white flash" */
	::view-transition-old(header),
	::view-transition-old(bottom-nav) {
		display: none;
	}

	::view-transition-new(header),
	::view-transition-new(bottom-nav) {
		animation: none;
	}
}

@keyframes vt-fade-in {
	from {
		opacity: 0;
		transform: translateY(6px);
	}

	to {
		opacity: 1;
		transform: translateY(0);
	}
}

@keyframes vt-fade-out {
	from {
		opacity: 1;
		transform: translateY(0);
	}

	to {
		opacity: 0;
		transform: translateY(-6px);
	}
}
